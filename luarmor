local SCRIPT_ID = "42f92b639d0394ac5806de25b07e26d5"
local LOADER_URL = "https://raw.githubusercontent.com/Ambriser/yurr/refs/heads/main/luarmor"
local KEY_FILE = "LHub_Key.txt"
local GET_KEY_LINK = "https://ads.luarmor.net/get_key?for=-LnDzsGFTqXOu"

-- unified loader
local function tryLoad(key)
    script_key = key
    script_id = SCRIPT_ID

    _G.script_key = key
    _G.script_id = SCRIPT_ID

    getgenv().script_key = key
    getgenv().script_id = SCRIPT_ID

    -- delete first so invalid keys never persist
    if isfile and delfile and isfile(KEY_FILE) then
        delfile(KEY_FILE)
    end

    -- if key is invalid, Luarmor kicks here
    loadstring(game:HttpGet(LOADER_URL))()

    -- if we reach here, key is valid
    if writefile then
        writefile(KEY_FILE, key)
    end
end

-- auto-load saved key
if isfile and isfile(KEY_FILE) then
    local savedKey = readfile(KEY_FILE)
    if savedKey and #savedKey == 32 then
        tryLoad(savedKey)
        return
    end
end

-- script_key passed directly
if script_key and #script_key == 32 then
    tryLoad(script_key)
    return
end

-- UI
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "L Hub! Key System",
    LoadingTitle = "Key Required",
    LoadingSubtitle = "by L",
    ToggleUIKeybind = "L",
})

local Tab = Window:CreateTab("Key")
local UserKey = ""

Tab:CreateButton({
    Name = "Copy Key Link",
    Callback = function()
        if setclipboard then
            setclipboard(GET_KEY_LINK)
        end
    end
})

Tab:CreateInput({
    Name = "Enter Key",
    PlaceholderText = "32-character key",
    Callback = function(text)
        UserKey = (text or ""):gsub("%s+", "")
    end
})

Tab:CreateButton({
    Name = "Verify Key",
    Callback = function()
        if #UserKey ~= 32 then
            Rayfield:Notify({
                Title = "Invalid Key",
                Content = "Key must be 32 characters",
                Duration = 3
            })
            return
        end

        tryLoad(UserKey)
        Rayfield:Destroy()
    end
})
