
local SCRIPT_ID = "42f92b639d0394ac5806de25b07e26d5"
local LOADER_URL = "https://api.luarmor.net/files/v4/loaders/42f92b639d0394ac5806de25b07e26d5.lua"
local LUARMOR_API_URL = "https://sdkapi-public.luarmor.net/library.lua"
local KEY_FILE = "LHub_Key.txt"
local GET_KEY_LINK = "https://ads.luarmor.net/get_key?for=-LnDzsGFTqXOu"


local function clean(s)
    return (s or ""):gsub("%s+", "")
end


local function validateKey(key)
    key = clean(key)
    if #key ~= 32 then
        return false
    end

    -- expose key
    script_key = key
    _G.script_key = key
    getgenv().script_key = key

    local ok, api = pcall(function()
        return loadstring(game:HttpGet(LUARMOR_API_URL))()
    end)
    if not ok or not api then
        return false
    end

    api.script_id = SCRIPT_ID
    api.key = key

    local success, status = pcall(function()
        return api.check_key()
    end)
    if not success or not status then
        return false
    end

    return status.code == "KEY_VALID"
end

local function loadHub()
    loadstring(game:HttpGet(LOADER_URL))()
end


if script_key and validateKey(script_key) then
    writefile(KEY_FILE, script_key)
    loadHub()
    return
end


if isfile(KEY_FILE) then
    local saved = clean(readfile(KEY_FILE))
    if validateKey(saved) then
        loadHub()
        return
    else
        delfile(KEY_FILE)
    end
end


local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "L Hub! Key Loader",
    LoadingTitle = "Enter Key",
    LoadingSubtitle = "by L",
    ToggleUIKeybind = "L",
})

local Tab = Window:CreateTab("Key System")
local UserKey = ""

Tab:CreateButton({
    Name = "Copy Key Link",
    Callback = function()
        setclipboard(GET_KEY_LINK)
    end
})

Tab:CreateInput({
    Name = "Enter Key",
    PlaceholderText = "Paste your 32-char key",
    Callback = function(text)
        UserKey = clean(text)
    end
})

Tab:CreateButton({
    Name = "Verify Key",
    Callback = function()
        if validateKey(UserKey) then
            writefile(KEY_FILE, UserKey)
            Rayfield:Destroy()
            loadHub()
        else
            Rayfield:Notify({
                Title = "Invalid Key",
                Content = "Key verification failed",
                Duration = 3
            })
        end
    end
})
